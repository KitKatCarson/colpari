var wpasGadget={init:function(a){this.data=a;var b=new XMLHttpRequest;b.open("GET",this.data.url+"wpas-api/v1/remote-tickets/"+this.data.gadgetID),b.setRequestHeader("Content-type","application/json"),b.onload=function(){var a=JSON.parse(b.responseText);void 0!==a.settings&&(wpasGadget.data=a.settings,"on"!=wpasGadget.data.disable&&wpasGadget.showForm()&&wpasGadget.createDOM())},b.send()},createDOM:function(){var a=this.getCSS();this.button=this.createElement("button",{id:"wpas-button",class:"wpas-button","data-action":"submit"}),this.wrapper=this.createElement("div",{class:"wpas-wrapper"}),this.button.innerHTML=this.data.buttonText,this.maybeHideHelpButton(),this.wrapper.setAttribute("class","wpas-wrapper"),this.wrapper.appendChild(a),this.wrapper.appendChild(this.button),this.getStylesheet(),this.createForm(),this.button.addEventListener("click",this.handleButtonClick),document.body.appendChild(this.wrapper)},createForm:function(){void 0!==this.formWrap&&this.wrapper.removeChild(this.formWrap),this.close=this.createElement("button",{id:"wpas-close",class:"wpas-close"}),this.formWrap=this.getTicketForm(),this.close.innerHTML="x",this.form.appendChild(this.close),this.wrapper.appendChild(this.formWrap),this.close.addEventListener("click",this.handleClose),this.formWrap.addEventListener("click",this.handleWrapClick),this.form.addEventListener("submit",this.handleTicketSubmit)},handleWrapClick:function(a){a.target===wpasGadget.formWrap&&wpasGadget.handleClose(a)},handleClose:function(a){void 0!==a&&a.preventDefault(),wpasGadget.button.setAttribute("data-action","submit"),wpasGadget.button.innerHTML=wpasGadget.data.buttonText,wpasGadget.formWrap.setAttribute("style","display:none;")},handleButtonClick:function(a){var b=wpasGadget.button,c=wpasGadget.formWrap,d=b.getAttribute("data-action");"submit"===d||"create"===d?(b.setAttribute("data-action","cancel"),b.innerHTML=wpasGadget.data.buttonCancelText,c.setAttribute("style","display:block;")):(b.setAttribute("data-action","submit"),b.innerHTML=wpasGadget.data.buttonText,c.setAttribute("style","display:none;"))},handleTicketSubmit:function(a){var b,c,d=[],e={};a.preventDefault();var f=Object.keys(wpasGadget.data.labels),g=wpasGadget.form;f.push("gadget_id");for(var h=0;h<f.length;h++)b=f[h],c=g.querySelector("[name="+b+"]"),e[b]="file"===b?c.files[0]:c.value,"file"===b||Boolean(e[b])||d.push(wpasGadget.data.errorText.replace("%s",wpasGadget.data.labels[b]));wpasGadget.handleFormErrors(d)&&wpasGadget.submitTicket(e)},showForm:function(){if(!Array.isArray(this.data.pageMatches))return!0;if(!this.data.pageMatches.length)return!0;for(var a=window.location.href,b="include"===this.data.pageMatchesSetting,c=0;c<this.data.pageMatches.length;c++)if(-1!==a.indexOf(this.data.pageMatches[c]))return b;return!b},getTicketForm:function(){var a,b,c,d,e,f,g=Object.keys(this.data.labels),h=this.createElement("div",{class:"wpas-ticket-wrapper",id:"wpas-ticket-wrapper"});this.form=this.createElement("form",{class:"wpas-ticket-form",id:"wpas-ticket-form"}),this.formMessages=this.createElement("div",{class:"wpas-ticket-form-messages",id:"wpas-ticket-form-messages"}),this.data.leftHeaderText&&(formHeaderLeft=this.createElement("p",{class:"wpas-rt-form-header-text-wrap"}),formHeaderLeft.innerHTML=this.data.leftHeaderText,this.form.appendChild(formHeaderLeft)),this.data.rightHeaderText&&(formHeaderRight=this.createElement("p",{class:"wpas-rt-form-header-text-wrap"}),formHeaderRight.innerHTML=this.data.rightHeaderText,this.form.appendChild(formHeaderRight));for(var i=0;i<g.length;i++)d=g[i],c=this.data.labels[d],e=this.createElement("p",{class:d+"-wrap"}),b=this.createElement("label",{for:"wpas_"+d}),b.innerHTML=c,a=this.getField(d),e.appendChild(b),e.appendChild(a),this.form.appendChild(e);this.data.preFooterText&&(formPreFooter=this.createElement("p",{class:"wpas-rt-form-footer-text-wrap"}),formPreFooter.innerHTML=this.data.preFooterText,this.form.appendChild(formPreFooter)),"on"==this.data.enableTos&&this.data.tosText&&(e=this.createElement("p",{class:"tos-wrap"}),ctos=this.createElement("input",{class:"tos"}),ctos.type="checkbox",ctos.id="tosChkbox",ctos.value=1,ctos.required=!0,ctos.defaultvalue=0,ltos=this.createElement("label",{class:"label_tos"}),ltos.setAttribute("for",ctos.id),ltos.setAttribute("id","tosLabel"),ltos.innerHTML=this.data.tosText,e.appendChild(ctos),e.appendChild(ltos),this.form.appendChild(e)),e=this.createElement("p",{class:"submit-wrap"});var j=this.createElement("input",{type:"hidden",name:"gadget_id",value:this.data.gadgetID}),k=this.createElement("input",{type:"submit",id:"wpas-ticket-submit",class:"wpas-ticket-submit",value:this.data.buttonText});return e.appendChild(j),e.appendChild(k),this.form.appendChild(e),this.data.footerText&&(f=this.createElement("p",{class:"wpas-rt-form-footer-text-wrap"}),f.innerHTML=this.data.footerText,this.form.appendChild(f)),this.form.appendChild(this.formMessages),h.appendChild(this.form),h},handleFormErrors:function(a){var b,c;if(this.formMessages.innerHTML="",!a.length)return!0;for(var d=0;d<a.length;d++)b=this.createElement("p",{class:"wpas-error"}),c=a[d],b.innerHTML=c,this.formMessages.appendChild(b);return!1},handleFormSuccess:function(a){var b,c=this.createElement("p",{class:"wpas-success"});this.formMessages.innerHTML=this.formWrap.innerHTML="",this.form=this.createElement("div",{class:"wpas-ticket-form",id:"wpas-ticket-form"}),b=this.createElement("button",{id:"wpas-button-success",class:"wpas-ticket-submit"}),c.innerHTML=this.data.successText.replace("[ticket-url]",'<a href="'+a.link+'">'+a.link+"</a>"),b.innerHTML=this.data.successButtonText,b.addEventListener("click",function(a){wpasGadget.handleClose(a),wpasGadget.createForm()}),this.formMessages.appendChild(c),this.formMessages.appendChild(this.createElement("p").appendChild(b)),this.form.appendChild(this.formMessages),this.formWrap.appendChild(this.form)},getStylesheet:function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("link");b.id="awesome-support-css",b.rel="stylesheet",b.type="text/css",b.href=this.data.cssURL,b.media="all",a.appendChild(b)},getField:function(a){switch(a){case"password":return this.createElement("input",{type:"password",name:a,id:"wpas_"+a});case"content":return this.createElement("textarea",{name:a,id:"wpas_"+a,rows:"6"});case"product":case"department":case"ticket_priority":var b=this.createElement("select",{name:a,id:"wpas_"+a});return this.getTaxonomy(a,b),b;case"file":return this.createElement("input",{type:"file",name:a,id:"wpas_"+a});default:return this.createElement("input",{type:"text",name:a,id:"wpas_"+a})}},createElement:function(a,b){var c=document.createElement(a);for(var d in b)c.setAttribute(d,b[d]);return c},getCSS:function(){var a="";a+=".wpas-button, .wpas-ticket-submit {background:"+this.data.buttonColor+" !important;color:"+this.data.buttonTextColor+" !important;}",a+=".wpas-button {"+this.data.buttonPosition+":20px;}",a+=".wpas-button:hover {background:"+this.data.buttonColor+" !important;color:"+this.data.buttonTextColor+" !important;}",a+=".wpas-ticket-wrapper {background-color:"+this.data.formBackgroundColor+";}",a+=this.data.css;var b=document.createElement("style");return b.type="text/css",b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a)),b},maybeHideHelpButton:function(){"on"==this.data.invisibleButton&&(wpasGadget.button.style.visibility="hidden")},getTaxonomy:function(a,b){var c=new XMLHttpRequest;c.open("GET",this.data.url+"wpas-api/v1/"+a),c.setRequestHeader("Content-type","application/json"),c.onload=function(){var a,d=JSON.parse(c.responseText);for(var e in d)d[e].hasOwnProperty("id")&&(a=wpasGadget.createElement("option",{value:d[e].id}),a.innerHTML=d[e].name,b.appendChild(a))},c.send()},submitTicket:function(a){var b=new XMLHttpRequest;b.open("POST",this.data.url+"wpas-api/v1/tickets"),b.setRequestHeader("Content-type","application/json"),b.onload=function(){var c=JSON.parse(b.responseText);201===b.status?void 0!==a.file&&a.file?wpasGadget.sendFile(a,c):wpasGadget.handleFormSuccess(c):void 0!==c.code&&wpasGadget.handleFormErrors([c.message])},b.send(JSON.stringify(a));var c=this.createElement("p",{class:"wpas-processing"});c.innerHTML=this.data.processingText,this.formMessages.appendChild(c)},sendFile:function(a,b){if(!a.file||!b.id)return wpasGadget.handleFormSuccess(b);var c=new FormData;c.append("email",a.email),c.append("file",a.file),c.append("gadget_id",a.gadget_id),c.append("post",b.id),void 0!==a.password&&c.append("password",a.password);var d=new XMLHttpRequest;d.open("POST",this.data.url+"wpas-api/v1/attachments"),d.onload=function(){wpasGadget.handleFormSuccess(b)},d.send(c);var e=this.createElement("p",{class:"wpas-processing"});e.innerHTML=this.data.uploadingText,this.formMessages.appendChild(e)}};wpasGadget.init(wpasData);
//# sourceMappingURL=gadget-dist.js.map